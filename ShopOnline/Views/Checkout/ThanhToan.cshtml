@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@{
    Layout = null;
    ViewBag.Title = "NHShop - Thanh Toán";
}
@model ShopOnline.ViewModels.CheckOutViewModel

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>@ViewBag.Title</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Free HTML Templates" name="keywords">
    <meta content="Free HTML Templates" name="description">

    <!-- Favicon -->
    <link href="../LayoutShop/img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="~/LayoutShop/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="~/LayoutShop/css/style.css" rel="stylesheet">
</head>

<body>
    <!-- Topbar Start -->
    <div class="container-fluid">
        <div class="row bg-secondary py-2 px-xl-5">
            <div class="col-lg-6 d-none d-lg-block">
                <div class="d-inline-flex align-items-center">
                    <a class="text-dark" href="">FAQs</a>
                    <span class="text-muted px-2">|</span>
                    <a class="text-dark" href="">Help</a>
                    <span class="text-muted px-2">|</span>
                    <a class="text-dark" href="">Support</a>
                </div>
            </div>
            <div class="col-lg-6 text-center text-lg-right">
                <div class="d-inline-flex align-items-center">
                    <a class="text-dark px-2" href="">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a class="text-dark px-2" href="">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a class="text-dark px-2" href="">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                    <a class="text-dark px-2" href="">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a class="text-dark pl-2" href="">
                        <i class="fab fa-youtube"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="row align-items-center py-3 px-xl-5">
            <div class="col-lg-3 d-none d-lg-block">
                <a href="" class="text-decoration-none">
                    <h1 class="m-0 display-5 font-weight-semi-bold"><span class="text-primary font-weight-bold border px-3 mr-1">NH</span>Shop</h1>
                </a>
            </div>
            <div class="col-lg-6 col-6 text-left">
                <form action="">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search for products">
                        <div class="input-group-append">
                            <span class="input-group-text bg-transparent text-primary">
                                <i class="fa fa-search"></i>
                            </span>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-lg-3 col-6 text-right">
                <a class="btn border" asp-area="Cart" asp-controller="Cart" asp-action="GioHang" class="btn border">
                    <i class="fas fa-shopping-cart text-primary"></i>
                    <span class="badge">0</span>
                </a>
            </div>
        </div>
    </div>
    <!-- Topbar End -->
    <!-- Navbar Start -->
    <div class="container-fluid">
        <div class="row border-top px-xl-5">
            <div class="col-lg-3 d-none d-lg-block">
                <a class="btn shadow-none d-flex align-items-center justify-content-between bg-primary text-white w-100" data-toggle="collapse" href="#navbar-vertical" style="height: 65px; margin-top: -1px; padding: 0 30px;">
                    <h6 class="m-0">Categories</h6>
                    <i class="fa fa-angle-down text-dark"></i>
                </a>
                <nav class="collapse position-absolute navbar navbar-vertical navbar-light align-items-start p-0 border border-top-0 border-bottom-0 bg-light" id="navbar-vertical" style="width: calc(100% - 30px); z-index: 1;">
                    <div class="navbar-nav w-100 overflow-hidden" style="height: 410px">
                        <div class="nav-item dropdown">
                            <a href="#" class="nav-link" data-toggle="dropdown">Dresses <i class="fa fa-angle-down float-right mt-1"></i></a>
                            <div class="dropdown-menu position-absolute bg-secondary border-0 rounded-0 w-100 m-0">
                                <a href="" class="dropdown-item">Men's Dresses</a>
                                <a href="" class="dropdown-item">Women's Dresses</a>
                                <a href="" class="dropdown-item">Baby's Dresses</a>
                            </div>
                        </div>
                        <a href="" class="nav-item nav-link">Shirts</a>
                        <a href="" class="nav-item nav-link">Jeans</a>
                        <a href="" class="nav-item nav-link">Swimwear</a>
                        <a href="" class="nav-item nav-link">Sleepwear</a>
                        <a href="" class="nav-item nav-link">Sportswear</a>
                        <a href="" class="nav-item nav-link">Jumpsuits</a>
                        <a href="" class="nav-item nav-link">Blazers</a>
                        <a href="" class="nav-item nav-link">Jackets</a>
                        <a href="" class="nav-item nav-link">Shoes</a>
                    </div>
                </nav>
            </div>
            <div class="col-lg-9">
                <nav class="navbar navbar-expand-lg bg-light navbar-light py-3 py-lg-0 px-0">
                    <a href="" class="text-decoration-none d-block d-lg-none">
                        <h1 class="m-0 display-5 font-weight-semi-bold"><span class="text-primary font-weight-bold border px-3 mr-1">NH</span>Shop</h1>
                    </a>
                    <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
                        <div class="navbar-nav mr-auto py-0">
                            <a asp-area="Home" asp-controller="Home" asp-action="Index" class="nav-item nav-link">
                                Trang chủ
                            </a>
                            @* <a asp-area="MonitorInvoice" asp-controller="MonitorInvoice" asp-action="TheoDoiDonHang" class="nav-item nav-link">Theo dõi đơn hàng</a> *@
                        </div>
                        <div class="navbar-nav ml-auto py-0">
                            @if (HttpContextAccessor.HttpContext.Session.GetString("Username") != null)
                            {
                                <a class="nav-item nav-link" asp-controller="Personal" asp-action="ThongTinCaNhan">Trang cá nhân</a>
                                <a class="nav-item nav-link" asp-controller="Access" asp-action="Logout">Đăng xuất</a>
                            }
                            else
                            {
                                <!-- Hiển thị Login và Register khi chưa đăng nhập -->
                                <a class="nav-item nav-link" asp-area="Access" asp-controller="Access" asp-action="Login">Đăng nhập</a>
                                <a class="nav-item nav-link" asp-area="Access" asp-controller="Access" asp-action="Register">Đăng ký</a>
                            }
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </div>

    <!-- Navbar End -->
    <!-- Page Header Start -->
    <div class="container-fluid bg-secondary mb-5">
        <div class="d-flex flex-column align-items-center justify-content-center" style="min-height: 300px">
            <h1 class="font-weight-semi-bold text-uppercase mb-3">Thanh Toán</h1>
            <div class="d-inline-flex">
                <p class="m-0"><a href="">Trang Chủ</a></p>
                <p class="m-0 px-2">-</p>
                <p class="m-0">Thanh toán</p>
            </div>
        </div>
    </div>
    <!-- Page Header End -->
    <!-- Checkout Start -->
    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger">
            <ul>
                @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <li>@error.ErrorMessage</li>
                }
            </ul>
        </div>
    }
    <div class="container-fluid pt-5">
        <div class="row px-xl-5">
            <form asp-controller="Checkout" asp-action="ThanhToan" method="post" class="col-lg-8">
                <div class="mb-4">
                    <div class="row card border-secondary mb-5" style="margin: 0px;">
                        <div class="card-header bg-secondary border-0">
                            <h4 class="font-weight-semi-bold m-0">Thông Tin Thanh Toán</h4>
                        </div>
                        <div class="card-body">
                            @* <div style="margin-left: 20px; margin-bottom: 20px; color: blue !important;">
                                <input type="checkbox" name="GiongKhachHang" class="form-check-input" id="GiongKhachHang" value="false">
                                <label class="form-check-label" for="GiongKhachHang">Giống thông tin khách hàng?</label>
                            </div> *@
                            <div class="row">

                                <div class="col-md-6 form-group">
                                    <label for="recipientName" class="form-label">Tên người nhận</label>
                                    <input type="text" class="form-control" id="recipientName" placeholder="Nhập tên người nhận" name="TenNguoiNhan" required>
                                </div>

                                <div class="col-md-6 form-group">
                                    <label for="phone" class="form-label">Số điện thoại</label>
                                    <input type="text" class="form-control" id="phone" placeholder="Nhập số điện thoại" name="SoDienThoai" required pattern="^(\+84|0)(9[0-9]|8[0-9]|7[0-9]|6[0-9]|5[0-9]|4[0-9]|3[0-9])\d{7}$" title="Vui lòng nhập số điện thoại hợp lệ">
                                </div>

                                <div class="col-md-6 form-group">
                                    <label for="address" class="form-label">Địa chỉ nhận hàng</label>
                                    <div>
                                        <select class="form-select form-select-sm mb-3"  id="city" aria-label=".form-select-sm" >
                                            <option selected>Chọn tỉnh thành</option>
                                            <!-- Add options for city here -->
                                        </select>

                                        <select class="form-select form-select-sm mb-3"  id="district" aria-label=".form-select-sm" disabled >
                                            <option selected>Chọn quận huyện</option>
                                            <!-- Add options for district here -->
                                        </select>

                                        <select class="form-select form-select-sm"  id="ward" aria-label=".form-select-sm" disabled >
                                            <option selected>Chọn phường xã</option>
                                            <!-- Add options for ward here -->
                                        </select>
                                    </div>
                                </div>

                                <div class="col-md-6 form-group">
                                    <label for="specificAddress" class="form-label">Địa chỉ cụ thể</label>
                                    <input type="text" class="form-control" id="address" placeholder="Nhập địa chỉ nhận hàng">
                                </div>
                                <input type="hidden" id="fullAddress" name="DiaChiGH" value="" required>
                            </div>

                            <div>
                                <h4 class="font-weight-semi-bold mb-4">Phương Thức Giao Hàng</h4>
                                <div class="col-md-12 form-group">
                                    <div class="custom-control custom-checkbox">
                                        <input type="radio" class="custom-control-input" name="PhucThucGH" id="homeDelivery" value="Giao hàng tận nơi" checked>
                                        <label class="custom-control-label" for="homeDelivery">Giao hàng tận nơi</label>
                                       
                                    </div>
                                    <div class="custom-control custom-checkbox">
                                        <input type="radio" class="custom-control-input" name="PhucThucGH" id="storePickup" value="Nhận hàng tại cửa hàng">
                                        <label class="custom-control-label" for="storePickup">Nhận hàng tại cửa hàng</label>
                                        
                                    </div>
                                    <input type="hidden" id="ship" name="TienShip" value="20">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card border-secondary mb-5">
                    <div class="card-header bg-secondary border-0">
                        <h4 class="font-weight-semi-bold m-0">Phương Thức Thanh Toán</h4>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <div class="custom-control custom-radio">
                                <input type="radio" class="custom-control-input" name="PTTT" id="cashOnDelivery" value="Thanh toán khi nhận hàng" checked>
                                <label class="custom-control-label" for="cashOnDelivery">Thanh toán khi nhận hàng</label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="custom-control custom-radio">
                                <input type="radio" class="custom-control-input" name="PTTT" id="bankTransfer" value="Chuyển khoản">
                                <label class="custom-control-label" for="bankTransfer">Chuyển khoản</label>
                            </div>
                        </div>
                        <div class="">
                            <div class="custom-control custom-radio">
                                <input type="radio" class="custom-control-input" name="PTTT" id="momoPayment" value="momo">
                                <label class="custom-control-label" for="momoPayment">MoMo</label>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer border-secondary bg-transparent">
                        <button type="submit" class="btn btn-lg btn-block btn-primary font-weight-bold my-3 py-3">Đặt Hàng</button>
                    </div>
                </div>
            </form>
            <div class="col-lg-4">
                <div class="card border-secondary mb-5">
                        <div class="card-header bg-secondary border-0">
                            <h4 class="font-weight-semi-bold m-0">Đơn hàng</h4>
                        </div>
                        <div class="card-body">
                            <h5 class="font-weight-medium mb-3">Sản Phẩm</h5>
                        @foreach (var item in Model.SanPham)
                        {
                            <div class="d-flex justify-content-between">
                                <p>@item.TenSp</p>
                                @if (item.GiaGiam < item.GiaGoc)
                                {
                                    <div style="margin-Left: 25px !important;">
                                        <p><del>₫@String.Format("{0:#,0.000}", item.GiaGoc)</del></p>
                                        <p>₫@String.Format("{0:#,0.000}", item.GiaGiam)</p>
                                    </div>
                                }
                                else
                                {
                                    <div style="margin-Left: 25px !important;">
                                        <p>₫@String.Format("{0:#,0.000}", item.GiaGiam)</p>
                                    </div>
                                }
                            </div>
                        }
                            <hr class="mt-0">
                            <div class="d-flex justify-content-between mb-3 pt-1">
                                <h6 class="font-weight-medium">Tổng phụ</h6>
                                <h6 class="font-weight-medium">₫@String.Format("{0:#,0.000}", Model.TongTien)</h6>
                            </div>
                            <div class="d-flex justify-content-between mb-3 pt-1">
                                <h6 class="font-weight-medium">Giảm giá</h6>
                                <h6 class="font-weight-medium">₫@String.Format("{0:#,0.000}", Model.GiamGia)</h6>
                            </div>
                            <div class="d-flex justify-content-between">
                                <h6 class="font-weight-medium">Phí vận chuyển</h6>
                                <h6 id="shippingFeeDisplay" class="font-weight-medium">₫@String.Format("{0:#,0.000}", Model.TienShip)</h6>
                            </div>

                            <!-- Input ẩn lưu giá trị phí vận chuyển để gửi về server -->
                            <input type="hidden" id="ship" name="TienShip" value="@Model.TienShip" />

                            <div class="d-flex justify-content-between">
                                <h6 class="font-weight-medium">Quà Tặng</h6>
                                <h6 class="font-weight-medium" style="color: #da6d95; font-weight: 300;">
                                    @if (Model.QuaTang != null && Model.QuaTang.Any())
                                    {
                                        foreach (var gift in Model.QuaTang)
                                        {
                                            <span>@gift</span>

                                            <br /> <!-- Hiển thị từng quà tặng và xuống dòng -->
                                        }
                                    }
                                    else
                                    {
                                        <span>Không có quà tặng</span> <!-- Nếu không có quà tặng -->
                                    }
                                </h6>
                            </div>
                        </div>
                        <div class="card-footer border-secondary bg-transparent">
                            <div class="d-flex justify-content-between mt-2">
                                <h5 class="font-weight-bold">Tổng cộng</h5>
                                <h5 class="font-weight-bold">₫@String.Format("{0:#,0.000}", Model.TienThu)</h5>
                            </div>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout End -->
    <!-- Footer Start -->
    <div class="container-fluid bg-secondary text-dark mt-5 pt-5">
        <div class="row px-xl-5 pt-5">
            <div class="col-lg-4 col-md-12 mb-5 pr-3 pr-xl-5">
                <a href="" class="text-decoration-none">
                    <h1 class="mb-4 display-5 font-weight-semi-bold"><span class="text-primary font-weight-bold border border-white px-3 mr-1">NH</span>Shop</h1>
                </a>
                <p>Dolore erat dolor sit lorem vero amet. Sed sit lorem magna, ipsum no sit erat lorem et magna ipsum dolore amet erat.</p>
                <p class="mb-2"><i class="fa fa-map-marker-alt text-primary mr-3"></i>123 Street, New York, USA</p>
                <p class="mb-2"><i class="fa fa-envelope text-primary mr-3"></i>info@example.com</p>
                <p class="mb-0"><i class="fa fa-phone-alt text-primary mr-3"></i>+012 345 67890</p>
            </div>
            <div class="col-lg-8 col-md-12">
                <div class="row">
                    <div class="col-md-4 mb-5">
                        <h5 class="font-weight-bold text-dark mb-4">Quick Links</h5>
                        <div class="d-flex flex-column justify-content-start">
                            <a class="text-dark mb-2" href="index.html"><i class="fa fa-angle-right mr-2"></i>Home</a>
                            <a class="text-dark mb-2" href="shop.html"><i class="fa fa-angle-right mr-2"></i>Our Shop</a>
                            <a class="text-dark mb-2" href="detail.html"><i class="fa fa-angle-right mr-2"></i>Shop Detail</a>
                            <a class="text-dark mb-2" href="cart.html"><i class="fa fa-angle-right mr-2"></i>Shopping Cart</a>
                            <a class="text-dark mb-2" href="checkout.html"><i class="fa fa-angle-right mr-2"></i>Checkout</a>
                            <a class="text-dark" href="contact.html"><i class="fa fa-angle-right mr-2"></i>Contact Us</a>
                        </div>
                    </div>
                    <div class="col-md-4 mb-5">
                        <h5 class="font-weight-bold text-dark mb-4">Quick Links</h5>
                        <div class="d-flex flex-column justify-content-start">
                            <a class="text-dark mb-2" href="index.html"><i class="fa fa-angle-right mr-2"></i>Home</a>
                            <a class="text-dark mb-2" href="shop.html"><i class="fa fa-angle-right mr-2"></i>Our Shop</a>
                            <a class="text-dark mb-2" href="detail.html"><i class="fa fa-angle-right mr-2"></i>Shop Detail</a>
                            <a class="text-dark mb-2" href="cart.html"><i class="fa fa-angle-right mr-2"></i>Shopping Cart</a>
                            <a class="text-dark mb-2" href="checkout.html"><i class="fa fa-angle-right mr-2"></i>Checkout</a>
                            <a class="text-dark" href="contact.html"><i class="fa fa-angle-right mr-2"></i>Contact Us</a>
                        </div>
                    </div>
                    <div class="col-md-4 mb-5">
                        <h5 class="font-weight-bold text-dark mb-4">Newsletter</h5>
                        <form action="">
                            <div class="form-group">
                                <input type="text" class="form-control border-0 py-4" placeholder="Your Name" required="required" />
                            </div>
                            <div class="form-group">
                                <input type="email" class="form-control border-0 py-4" placeholder="Your Email"
                                       required="required" />
                            </div>
                            <div>
                                <button class="btn btn-primary btn-block border-0 py-3" type="submit">Subscribe Now</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row border-top border-light mx-xl-5 py-4">
            <div class="col-md-6 px-xl-0">
                <p class="mb-md-0 text-center text-md-left text-dark">
                    &copy; <a class="text-dark font-weight-semi-bold" href="#">Your Site Name</a>. All Rights Reserved. Designed
                    by
                    <a class="text-dark font-weight-semi-bold" href="https://htmlcodex.com">HTML Codex</a><br>
                    Distributed By <a href="https://themewagon.com" target="_blank">ThemeWagon</a>
                </p>
            </div>
            <div class="col-md-6 px-xl-0 text-center text-md-right">
                <img class="img-fluid" src="LayoutShop/img/payments.png" alt="">
            </div>
        </div>
    </div>
    <!-- Footer End -->
    <!-- Back to Top -->
    <a href="#" class="btn btn-primary back-to-top"><i class="fa fa-angle-double-up"></i></a>


    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/../LayoutShop/js/bootstrap.bundle.min.js"></script>
    <script src="~/LayoutShop/lib/easing/easing.min.js"></script>
    <script src="~/LayoutShop/lib/owlcarousel/owl.carousel.min.js"></script>

    <!-- Contact Javascript File -->
    <script src="mail/jqBootstrapValidation.min.js"></script>
    <script src="mail/contact.js"></script>

    <!-- Template Javascript -->
    <script src="~/LayoutShop/js/main.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        // Lấy các phần tử trong form
        const citySelect = document.getElementById('city');
        const districtSelect = document.getElementById('district');
        const wardSelect = document.getElementById('ward');
        const addressInput = document.getElementById('address');
        const fullAddressInput = document.getElementById('fullAddress');

        // Hàm cập nhật địa chỉ đầy đủ
        function updateFullAddress() {
            const cityText = citySelect.options[citySelect.selectedIndex].text; // Lấy tên thành phố
            const districtText = districtSelect.options[districtSelect.selectedIndex].text; // Lấy tên quận
            const wardText = wardSelect.options[wardSelect.selectedIndex].text; // Lấy tên phường
            const specificAddress = addressInput.value; // Lấy địa chỉ cụ thể

            // Kiểm tra nếu các trường đã được chọn và địa chỉ cụ thể đã nhập
            if (cityText !== "Chọn tỉnh thành" && districtText !== "Chọn quận huyện" && wardText !== "Chọn phường xã" && specificAddress !== "") {
                // Tạo địa chỉ đầy đủ
                const fullAddress = specificAddress + ", " + wardText + ", " + districtText + ", " + cityText;

                // Gán giá trị vào thẻ input hidden
                fullAddressInput.value = fullAddress;

                // In ra console (nếu cần)
                console.log("Địa chỉ đầy đủ: " + fullAddress);
                // Get the hidden input element

            } else {
                // Nếu chưa chọn đầy đủ hoặc chưa nhập địa chỉ cụ thể, xóa giá trị
                fullAddressInput.value = "";
            }
        }

        // Lắng nghe sự kiện change trên các select và input để cập nhật địa chỉ đầy đủ
        citySelect.addEventListener('change', updateFullAddress);
        districtSelect.addEventListener('change', updateFullAddress);
        wardSelect.addEventListener('change', updateFullAddress);
        addressInput.addEventListener('input', updateFullAddress);

        var citis = document.getElementById("city");
        var districts = document.getElementById("district");
        var wards = document.getElementById("ward");
        var shippingMethodRadios = document.getElementsByName("PhucThucGH"); // Updated to match the name in HTML
        var address = document.getElementById("address"); // Reference to the specific address input
        var shippingFeeInput = document.createElement("input"); // Create a hidden input for shipping fee
        shippingFeeInput.setAttribute("type", "hidden");
        shippingFeeInput.setAttribute("name", "shippingFee"); // Name for the shipping fee
        document.forms[0].appendChild(shippingFeeInput); // Add the hidden input to the form

        var data;  // Create a global variable to store data

        var Parameter = {
            url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
            method: "GET",
            responseType: "application/json",
        };

        var promise = axios(Parameter);
        promise.then(function (result) {
            data = result.data; 
            renderCity(data);    
        });

        function renderCity(data) {
            for (const x of data) {
                citis.options[citis.options.length] = new Option(x.Name, x.Id);
            }
            citis.onchange = function () {
                districts.length = 1; 
                wards.length = 1; 
                wards.disabled = true; 
                if (this.value != "") {
                    const result = data.filter(n => n.Id === this.value);
                    for (const k of result[0].Districts) {
                        districts.options[districts.options.length] = new Option(k.Name, k.Id);
                    }
                    districts.disabled = false; 
                } else {
                    districts.disabled = true; 
                }
            };

            districts.onchange = function () {
                wards.length = 1; 
                if (this.value != "") {
                    const dataCity = data.filter((n) => n.Id === citis.value);
                    const dataWards = dataCity[0].Districts.filter(n => n.Id === this.value)[0].Wards;
                    for (const w of dataWards) {
                        wards.options[wards.options.length] = new Option(w.Name, w.Id);
                    }
                    wards.disabled = false; 
                } else {
                    wards.disabled = true; 
                }
            };
        }

        //Thay đổi địa chỉ khi chọn phương thức giao hàng
        shippingMethodRadios.forEach(radio => {
            radio.addEventListener('change', function () {
                updateShippingFee();
                if (this.value === "Nhận hàng tại cửa hàng") {
                    citis.disabled = true;
                    districts.disabled = true;
                    wards.disabled = true;

                    setTimeout(() => {
                        citis.value = "79";

                        const cityData = data.find(c => c.Id === citis.value); 
                        districts.length = 1; 
                        for (const district of cityData.Districts) {
                            districts.options[districts.options.length] = new Option(district.Name, district.Id);
                        }

                        setTimeout(() => {
                            districts.value = "764"; 

                            const districtData = cityData.Districts.find(d => d.Id === districts.value);
                            wards.length = 1; 
                            for (const ward of districtData.Wards) {
                                wards.options[wards.options.length] = new Option(ward.Name, ward.Id);
                            }

                            setTimeout(() => {
                                wards.value = "26875"; 
                                address.value = "192 Nguyễn Oanh";

                                updateShippingFee(); 

                                
                                const cityText = citis.options[citis.selectedIndex].text; 
                                const districtText = districts.options[districts.selectedIndex].text; 
                                const wardText = wards.options[wards.selectedIndex].text; 
                                const specificAddress = address.value; 
                                
                                const fullAddress = specificAddress + ", " + wardText + ", " + districtText + ", " + cityText;
                              
                                document.getElementById('fullAddress').value = fullAddress;

                                console.log("Địa chỉ đầy đủ: " + specificAddress + ", " + wardText + ", " + districtText + ", " + cityText);



                            }, 500); 
                        }, 500); 
                    }, 500); 

                } else {
                    citis.disabled = false;
                    districts.disabled = false;
                    wards.disabled = false;

                    // Reset 
                    citis.value = "Chọn tỉnh thành";
                    districts.value = "Chọn quận huyện";
                    wards.value = "Chọn phường xã";
                    address.value = "";
                }
            });
        });


        function updateShippingFee() {
            // Lấy các phần tử liên quan
            var shippingFeeDisplay = document.getElementById('shippingFeeDisplay'); // Nơi hiển thị phí vận chuyển
            var shippingFeeInput = document.getElementById('ship'); // Input ẩn lưu giá trị phí vận chuyển
            var homeDelivery = document.getElementById('homeDelivery'); // Radio button "Giao hàng tận nơi"
            var initialShippingFee = parseInt(shippingFeeInput.value); // Lấy giá trị ban đầu của phí vận chuyển

            // Kiểm tra nếu phí vận chuyển ban đầu là 0, không thay đổi khi người dùng chọn bất kỳ lựa chọn nào
            if (@Model.TienShip === 0) {
                shippingFeeDisplay.innerText = "₫" + new Intl.NumberFormat('vi-VN').format(0);
                shippingFeeInput.value = 0;
                console.log("Phí vận chuyển cố định là 0.");
                return; // Không thực hiện thay đổi nào khác
            }

            // Nếu phí vận chuyển ban đầu khác 0, cho phép thay đổi dựa trên lựa chọn
            if (homeDelivery.checked) {
                shippingFeeInput.value = 20; // Cập nhật giá trị ẩn
                shippingFeeDisplay.innerText = "₫" + new Intl.NumberFormat('vi-VN').format(shippingFeeInput.value); // Hiển thị phí
            } else {
                shippingFeeInput.value = 0; // Miễn phí khi chọn nhận tại cửa hàng
                shippingFeeDisplay.innerText = "₫" + new Intl.NumberFormat('vi-VN').format(shippingFeeInput.value); // Hiển thị 0
            }

            // Kiểm tra kết quả trong console
            console.log("Phí giao hàng hiển thị:", shippingFeeDisplay.innerText);
            console.log("Phí giao hàng lưu trữ:", shippingFeeInput.value);
        }
        
    </script>
</body>

</html>
